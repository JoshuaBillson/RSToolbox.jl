<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Preprocessing · RemoteSensingToolbox.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://JoshuaBillson.github.io/RemoteSensingToolbox.jl/preprocessing_example/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">RemoteSensingToolbox.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../visualization_example/">Visualization</a></li><li class="is-active"><a class="tocitem" href>Preprocessing</a></li><li><a class="tocitem" href="../spectral_example/">Spectral Analysis</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Preprocessing</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Preprocessing</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JoshuaBillson/RemoteSensingToolbox.jl/blob/main/docs/src/preprocessing_example.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Preprocessing-Example"><a class="docs-heading-anchor" href="#Preprocessing-Example">Preprocessing Example</a><a id="Preprocessing-Example-1"></a><a class="docs-heading-anchor-permalink" href="#Preprocessing-Example" title="Permalink"></a></h1><p>In remote sensing, we often want to preprocess our imagery before using it in further analysis. For example, we may want to convert digital numbers to surface reflectance, crop to a region of interest, or cut our image into manageable tiles before feeding it into a machine learning algorithm. The first step is to read our data from disk. A variety of commons sensors are supported by <code>RemoteSensingToolbox</code>, but today we&#39;re going to be working with Landsat 8 imagery.</p><pre><code class="language-julia hljs">using RemoteSensingToolbox, Rasters, Images
using Pipe: @pipe

landsat = Landsat8(&quot;LC08_L2SP_043024_20200802_20200914_02_T1/&quot;)</code></pre><p>Most remote sensing images encode each pixel as a Digital Number (DN). Unfortunately, this is not very interpretable for a variety of applications, particularly in the case of land cover classification. A much better measurement is reflectance, which is defined as a number between 0 and 1, which indicates the fraction of light that is reflected by the observed surface. The specifics of converting from DN to reflectance differs from one sensor to the next. Fortunately, all <code>AbstractSensor</code> types contain this information implicitly. Thus, we can simple call <code>dn_to_reflectance</code> to turn our DNs to surface reflectance.</p><pre><code class="language-julia hljs">landsat_sr = dn_to_reflectance(landsat)</code></pre><p>When we visualize our data, we observe the present of a large number of clouds.</p><pre><code class="language-julia hljs">visualize(landsat_sr, TrueColor; upper=0.90)</code></pre><p><img src="../figures/true_color.png" alt/></p><p>In many applications, we need to remove all pixels covered by clouds before further processing. Fortunately, Landsat images comes with a Quality Assurance (QA) file which, among other things, gives us a mask of all detected cloud pixels. However, this data is not easy to interpret, as each mask is encided as a specific bit in an unsigned 16 bit integer. <code>RemoteSensingToolbox</code> provides the <code>landsat_qa</code> method to decode the QA image into a more interpretable form.</p><pre><code class="language-julia hljs">qa = landsat_qa(&quot;LC08_L2SP_043024_20200802_20200914_02_T1/LC08_L2SP_043024_20200802_20200914_02_T1_QA_PIXEL.TIF&quot;)</code></pre><pre><code class="nohighlight hljs">RasterStack with dimensions: 
  X Projected{Float64} LinRange{Float64}(493785.0, 728385.0, 7821) ForwardOrdered Regular Points crs: WellKnownText,
  Y Projected{Float64} LinRange{Float64}(5.84638e6, 5.60878e6, 7921) ReverseOrdered Regular Points crs: WellKnownText
and 8 layers:
  :fill          UInt8 dims: X, Y (7821×7921)
  :dilated_cloud UInt8 dims: X, Y (7821×7921)
  :cirrus        UInt8 dims: X, Y (7821×7921)
  :cloud         UInt8 dims: X, Y (7821×7921)
  :cloud_shadow  UInt8 dims: X, Y (7821×7921)
  :snow          UInt8 dims: X, Y (7821×7921)
  :clear         UInt8 dims: X, Y (7821×7921)
  :water         UInt8 dims: X, Y (7821×7921)</code></pre><p>Now that we have the QA masks, we can use the <code>mask_pixels</code> method to remove the presence of clouds and cloud shadows.</p><pre><code class="language-julia hljs">@pipe mask_pixels(landsat_sr, qa[:cloud]) |&gt; 
mask_pixels(_, qa[:cloud_shadow]) |&gt; 
visualize(_, TrueColor)</code></pre><p><img src="../figures/masked.png" alt/></p><p>Next, let&#39;s crop our rasters to a region of interest. All <code>AbstractSensor</code> types are compatible with the standard view and index operations supported by <code>Rasters.jl</code>.</p><pre><code class="language-julia hljs">roi = @view landsat_sr[X(5801:6800), Y(2201:3200)]</code></pre><p>Remotely sensed imagery is often too large to be used directly in machine learning applications. Thus, it is common practice to cut a raster into several smaller tiles, which may partially overlap with one another to increase the number of samples available to us. This can be accomplished with the <code>create_tiles</code> method, which provides an optional <code>stride</code> argument specifying how far apart each tile should be in the x and y dimensions. By default, <code>stride</code> is equal to the tile size, but setting <code>stride</code> to a smaller value allows us to generate overlapping tiles.</p><pre><code class="language-julia hljs">tiles = create_tiles(roi, (500, 500))
overlapping_tiles = create_tiles(roi, (500, 500); stride=(250, 250))</code></pre><p>To better understand how <code>create_tiles</code> works, let&#39;s visualize the result of generating non-overlapping and half-overlapping tiles.</p><pre><code class="language-julia hljs">@pipe tiles |&gt; 
visualize.(_, TrueColor; upper=0.998) |&gt; 
mosaicview(_, ncol=2, rowmajor=true, npad=5, fillvalue=1.0)</code></pre><p><img src="../figures/landsat_tiles.png" alt/></p><pre><code class="language-julia hljs">@pipe overlapping_tiles |&gt; 
visualize.(_, TrueColor; upper=0.998) |&gt; 
mosaicview(_, ncol=2, rowmajor=true, npad=5, fillvalue=1.0)</code></pre><p><img src="../figures/landsat_overlapping_tiles.png" alt/></p><p>Finally, we&#39;re ready to save our tiles to disk. However, instead of saving each band as a separate file, we can combine them into a single multi-band raster. To do so, we use the <code>tocube</code> method, which optionally takes a list of layers that we want to write to the raster. By default, all layers are included. In this example, we will keep only the blue, green, red, and nir bands for each tile.</p><pre><code class="language-julia hljs">cubes = map(x -&gt; tocube(x; layers=[:B2, :B3, :B4, :B5]), tiles)
for (i, cube) in enumerate(cubes)
   Rasters.write(&quot;tile_$i.tif&quot;, cube)
end</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../visualization_example/">« Visualization</a><a class="docs-footer-nextpage" href="../spectral_example/">Spectral Analysis »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Friday 9 June 2023 05:28">Friday 9 June 2023</span>. Using Julia version 1.9.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>

<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Principal Component Analysis · RemoteSensingToolbox.jl</title><meta name="title" content="Principal Component Analysis · RemoteSensingToolbox.jl"/><meta property="og:title" content="Principal Component Analysis · RemoteSensingToolbox.jl"/><meta property="twitter:title" content="Principal Component Analysis · RemoteSensingToolbox.jl"/><meta name="description" content="Documentation for RemoteSensingToolbox.jl."/><meta property="og:description" content="Documentation for RemoteSensingToolbox.jl."/><meta property="twitter:description" content="Documentation for RemoteSensingToolbox.jl."/><meta property="og:url" content="https://JoshuaBillson.github.io/RemoteSensingToolbox.jl/pca_example/"/><meta property="twitter:url" content="https://JoshuaBillson.github.io/RemoteSensingToolbox.jl/pca_example/"/><link rel="canonical" href="https://JoshuaBillson.github.io/RemoteSensingToolbox.jl/pca_example/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">RemoteSensingToolbox.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../quickstart/">Quick Start</a></li><li><a class="tocitem" href="../pansharpening/">Pansharpening</a></li><li class="is-active"><a class="tocitem" href>Principal Component Analysis</a></li><li><a class="tocitem" href="../spectral_example/">Spectral Analysis</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Principal Component Analysis</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Principal Component Analysis</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JoshuaBillson/RemoteSensingToolbox.jl/blob/main/docs/src/pca_example.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Principal-Component-Analysis"><a class="docs-heading-anchor" href="#Principal-Component-Analysis">Principal Component Analysis</a><a id="Principal-Component-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Principal-Component-Analysis" title="Permalink"></a></h1><p>Remotely sensed imagery typically consists of anywhere from five to several hundred spectral bands. These bands are often highly correlated because they occupy similar spectral regions. </p><p>PCA is used in remote sensing to:</p><ul><li>Create a smaller dataset from multiple bands, while retaining as much of the original spectral information as possible. The new image will consist of several uncorrelated PC bands.</li><li>Reveal complex relationships among spectral features.</li><li>Determine which characteristics are prevalent in most of the bands, and those that are specific to only a few.</li></ul><p>Our first step is to load and visualize our data.</p><pre><code class="language-julia hljs">using RemoteSensingToolbox, Rasters, ArchGDAL, DataDeps, Fetch
using Pipe: @pipe

# DataDeps Settings
ENV[&quot;DATADEPS_ALWAYS_ACCEPT&quot;] = true
ENV[&quot;DATADEPS_LOAD_PATH&quot;] = joinpath(pwd(), &quot;data&quot;)

# Fetch Sentinel 2 Scene from Google Drive
register(
    DataDep(
        &quot;S2B_MSIL2A_20200804T183919_N0214_R070_T11UPT_20200804T230343&quot;, 
        &quot;&quot;&quot;Sentinel 2 Test Data&quot;&quot;&quot;, 
        &quot;https://drive.google.com/file/d/1P7TSPf_GxYtyOYat3iIui1hbjvb7H6a0/view?usp=sharing&quot;, 
        &quot;4135c6192a314e0d08d21cf44ca3cde0f34f1968854275e32656278ca163a3e0&quot;, 
        fetch_method=gdownload, 
        post_fetch_method=unpack
    )
)

# Read Sentinel 2 Bands at 60m Resolution
src = Sentinel2{60}(datadep&quot;S2B_MSIL2A_20200804T183919_N0214_R070_T11UPT_20200804T230343&quot;)
sentinel = RasterStack(src; lazy=false)

# Extract Region of Interest
roi = @view sentinel[Rasters.X(900:1799), Rasters.Y(1:900)]

# Visualize Original Image
true_color(Sentinel2{60}, roi; upper=0.99)</code></pre><p><img src="../figures/original.jpg" alt/></p><p>Next, we&#39;ll fit a PCA transformation to our image. We can optionally specify a fraction of  pixels to use for computing the transformation statistics. Choosing a value less than one can greatly reduce the computation time at the expense of precision. However, for sufficiently large  images, a fraction of 0.1 provides near-identical results to those acquired from the complete data  set.</p><pre><code class="language-julia hljs">pca = fit_pca(sentinel; method=:cov, stats_fraction=0.1)</code></pre><pre><code class="nohighlight hljs">PCA(dimensions=11) 

Projection Matrix:
11×11 Matrix{Float32}:
 -0.026   -0.2068   0.359    0.312   -0.0956  -0.4791  -0.2246   0.6115  -0.187   -0.1491   0.1007
 -0.0361  -0.2354   0.3739   0.1417  -0.0496  -0.1544  -0.384   -0.3905   0.3475   0.2424  -0.5269
 -0.0775  -0.2406   0.3554  -0.1492   0.0608   0.0574  -0.0611  -0.2325   0.4331  -0.2812   0.6754
 -0.0396  -0.3231   0.321   -0.0301  -0.048    0.4006  -0.1104  -0.1695  -0.6672   0.3335   0.1734
 -0.1194  -0.2914   0.2233  -0.3824   0.3988   0.3537   0.1552   0.388    0.0935  -0.2656  -0.4083
 -0.3925   0.0354   0.0791  -0.5716   0.1024  -0.5641   0.2124  -0.0647  -0.1093   0.3454   0.0492
 -0.4949   0.1513   0.0179  -0.1063  -0.4124   0.0177  -0.1552  -0.2315  -0.2583  -0.6104  -0.1825
 -0.5216   0.1354  -0.1415  -0.0112  -0.2273   0.3424  -0.332    0.3901   0.3023   0.3891   0.1241
 -0.5257   0.084    0.0977   0.6027   0.4321   0.0232   0.3684  -0.1417  -0.0191   0.0176   0.0145
 -0.155   -0.549   -0.63     0.0249   0.3084  -0.1467  -0.3609  -0.0952  -0.0891  -0.098    0.0592
 -0.0695  -0.5511  -0.1381   0.1059  -0.5562   0.0012   0.5628   0.0345   0.1566   0.0705  -0.0666

Importance of Components:
  Cumulative Variance: 0.76  0.9679  0.989  0.9938  0.9968  0.9984  0.9991  0.9995  0.9998  ...  1.0
  Explained Variance: 0.76  0.2078  0.0212  0.0047  0.0031  0.0016  0.0007  0.0004  0.0002  ...  0.0001</code></pre><p>If we look at the cumulative variance, we see that we only need to retain the first three principal  components to account for 98.9% of the sample variance. Knowing this, we&#39;ll perform a forward rotation with <code>forward_pca</code> while specifying that we only want to keep the first three components.</p><pre><code class="language-julia hljs"># Perform a PCA Transformation while Retaining the First Three Components
transformed = forward_pca(pca, roi, 3)

# Visualize Transformation
r, g, b = (view(transformed, Rasters.Band(i)) for i in 1:3)
visualize(r, g, b; upper=0.99)</code></pre><p><img src="../figures/pca.jpg" alt/></p><p>Each band in the transformed image corresponds to a linear combination of multiple bands from the  original image. Thus, the bands no longer relate to wavelengths of light, but instead capture  different characteristics of the underlying spectral signatures. In the above visualization, we  observe that water is highlighted in yellow, vegetation is green, and built-up land is magenta. </p><p>We may also wish to reverse the transformation in order to recover an approximation of the original  image. This can be achieved with the <code>inverse_pca</code> method, which expects both a learned PCA rotation  and a previously transformed image as input. The return value is a <code>Raster</code>, which does not retain  any of the band names from the original image. To make our recovered image compatible with the  <code>Sentinel2</code> type, we need to restore the layer names by passing the result to <code>RasterStack</code>.</p><pre><code class="language-julia hljs"># Reverse Transformation
recovered = RasterStack(inverse_pca(pca, transformed), layersfrom=Band, name=names(roi))

# Visualize Recovered Image
true_color(Sentinel2{60}, recovered; upper=0.99)</code></pre><p><img src="../figures/recovered.jpg" alt/></p><p>We can see that while the color of the recovered image is indeed similar to that of the original, there are some noticeable discrepancies. This is because some information was lost when we discarded the other eight principal components. Had we elected to retain all 11 components, we would find the  two images to be identical, minus some floating point error.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../pansharpening/">« Pansharpening</a><a class="docs-footer-nextpage" href="../spectral_example/">Spectral Analysis »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Monday 15 January 2024 07:29">Monday 15 January 2024</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
